<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Di·ªÖn ƒë√†n</title>

  <!-- CSS -->
  <link rel="stylesheet" th:href="@{/css/home_page.css}">
  <link rel="stylesheet" th:href="@{/css/Forum.css}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link rel="icon" type="image/png" th:href="@{/Course_img/logo_1.png}">

  <!-- JS -->
  <script th:src="@{/js/forum_page.js}" defer></script>
  <script th:src="@{/js/review_page_script.js}" defer></script>
</head>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    background-color: #f0f2f5;
  }

  .container {
    max-width: 1600px;
    margin: 0px 20px 0px 20px;
  }

  .forum-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }

  .forum-header h3 {
    font-size: 24px;
    color: #333;
  }

  .forum-posts-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 20px;
  }

  .forum-post-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
    cursor: pointer;
  }

  .forum-post-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 20px rgba(0,0,0,0.15);
  }

  .post-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 15px;
  }

  .post-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea, #764ba2);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
  }

  .post-user-info {
    flex: 1;
  }

  .post-username {
    font-weight: 600;
    color: #333;
    font-size: 14px;
  }

  .post-time {
    color: #888;
    font-size: 12px;
  }

  .post-title {
    font-size: 18px;
    font-weight: 600;
    color: #333;
    margin-bottom: 10px;
    line-height: 1.4;
  }

  .post-content {
    color: #666;
    font-size: 14px;
    line-height: 1.6;
    margin-bottom: 15px;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .post-tags {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-bottom: 15px;
  }

  .post-tag {
    background: #f0f0f0;
    color: #666;
    padding: 4px 12px;
    border-radius: 15px;
    font-size: 12px;
  }

  .post-stats {
    display: flex;
    gap: 20px;
    color: #888;
    font-size: 13px;
    padding-top: 15px;
    border-top: 1px solid #f0f0f0;
  }

  .post-stat {
    display: flex;
    align-items: center;
    gap: 5px;
    cursor: pointer;
    transition: color 0.2s;
  }

  .post-stat:hover {
    color: #667eea;
  }

  .post-stat i {
    color: #667eea;
  }

  /* Modal Styles */
  .modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.7);
    z-index: 1000;
    animation: fadeIn 0.3s ease;
  }

  /* Thay th·∫ø CSS c·ªßa modal-overlay v√† modal-container trong file g·ªëc */

  .modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.7);
    z-index: 1000;
    animation: fadeIn 0.3s ease;
    overflow-y: auto; /* CHO PH√âP CU·ªòN */
    padding: 20px 0; /* TH√äM PADDING */
  }

  .modal-overlay.active {
    display: flex;
    justify-content: center;
    align-items: flex-start; /* THAY ƒê·ªîI T·ª™ center TH√ÄNH flex-start */
    padding-top: 40px; /* TH√äM PADDING TOP */
  }

  .modal-container {
    background: white;
    border-radius: 16px;
    max-width: 1200px;
    width: 100%;
    margin: 20px 40px 40px 40px; /* TH√äM MARGIN BOTTOM */
    display: flex;
    flex-direction: column;
    max-height: none; /* X√ìA MAX-HEIGHT C·ªê ƒê·ªäNH */
    animation: slideUp 0.3s ease;
    justify-content: space-between;
    align-items: center;
  }

  .modal-header {
    padding: 20px;
    width: 100%;
    border-bottom: 1px solid #e0e0e0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    top: 0; /* TH√äM TOP */
    background: white; /* ƒê·∫¢M B·∫¢O N·ªÄN TR·∫ÆNG */
    z-index: 10; /* ƒê·∫¢M B·∫¢O ·ªû TR√äN */
    border-radius: 16px 16px 0 0; /* GI·ªÆ BO G√ìC */
  }

  .modal-content {
    padding: 40px;
    min-width: 1200px;
    overflow-y: visible; /* THAY ƒê·ªîI T·ª™ auto TH√ÄNH visible */
    overflow-x: hidden;
  }

  /* ƒê·∫£m b·∫£o comment input kh√¥ng b·ªã ·∫©n */
  .comment-input-container {
    position: relative;
    z-index: 1;
  }

  /* C·∫£i thi·ªán scrollbar cho modal-overlay */
  .modal-overlay::-webkit-scrollbar {
    width: 10px;
  }

  .modal-overlay::-webkit-scrollbar-track {
    background: rgba(0,0,0,0.1);
  }

  .modal-overlay::-webkit-scrollbar-thumb {
    background: rgba(255,255,255,0.3);
    border-radius: 5px;
  }

  .modal-overlay::-webkit-scrollbar-thumb:hover {
    background: rgba(255,255,255,0.5);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .modal-overlay {
      padding: 0;
    }

    .modal-overlay.active {
      padding-top: 0;
    }

    .modal-container {
      max-height: none;
      border-radius: 0;
      margin: 0;
      min-height: 100vh;
    }

    .modal-header {
      border-radius: 0;
    }

    .modal-content {
      padding: 20px;
    }
  }

  .modal-post-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
  }

  .modal-post-avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea, #764ba2);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    font-size: 18px;
  }

  .modal-post-title {
    font-size: 24px;
    font-weight: 700;
    color: #333;
    margin-bottom: 15px;
    line-height: 1.4;
  }

  .modal-post-content {
    color: #333;
    font-size: 15px;
    line-height: 1.8;
    margin-bottom: 20px;
  }

  .modal-post-actions {
    display: flex;
    gap: 20px;
    padding: 15px 0;
    border-top: 1px solid #e0e0e0;
    border-bottom: 1px solid #e0e0e0;
    margin-bottom: 25px;
  }

  .action-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    border: none;
    background: none;
    color: #666;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    border-radius: 8px;
    transition: all 0.2s;
  }

  .action-btn:hover {
    background: #f0f0f0;
    color: #667eea;
  }

  .action-btn.active {
    color: #667eea;
  }

  .action-btn i {
    font-size: 16px;
  }

  .comments-section {
    margin-top: 20px;
  }

  .comments-header {
    font-size: 18px;
    font-weight: 600;
    color: #333;
    margin-bottom: 20px;
  }

  .comment-input-container {
    display: flex;
    gap: 12px;
    margin-bottom: 25px;
  }

  .comment-input-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea, #764ba2);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    flex-shrink: 0;
  }

  .comment-input-wrapper {
    flex: 1;
  }

  .comment-input {
    width: 100%;
    padding: 12px 16px;
    border: 1px solid #e0e0e0;
    border-radius: 20px;
    font-size: 14px;
    font-family: inherit;
    resize: none;
    transition: all 0.2s;
  }

  .comment-input:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }

  .comment-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 10px;
  }

  .comment-btn {
    padding: 8px 20px;
    border: none;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
  }

  .comment-btn-cancel {
    background: #f0f0f0;
    color: #666;
  }

  .comment-btn-cancel:hover {
    background: #e0e0e0;
  }

  .comment-btn-submit {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
  }

  .comment-btn-submit:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
  }

  .comment-btn-submit:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .comments-list {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .comment-item {
    display: flex;
    gap: 12px;
  }

  .comment-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea, #764ba2);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    flex-shrink: 0;
  }

  .comment-content-wrapper {
    flex: 1;
  }

  .comment-bubble {
    background: #f0f2f5;
    padding: 12px 16px;
    border-radius: 18px;
    margin-bottom: 5px;
  }

  .comment-username {
    font-weight: 600;
    color: #333;
    font-size: 14px;
    margin-bottom: 5px;
  }

  .comment-text {
    color: #333;
    font-size: 14px;
    line-height: 1.6;
  }

  .comment-meta {
    display: flex;
    gap: 15px;
    padding-left: 16px;
    color: #888;
    font-size: 12px;
  }

  .comment-action {
    cursor: pointer;
    font-weight: 500;
    transition: color 0.2s;
  }

  .comment-action:hover {
    color: #667eea;
  }

  .no-comments {
    text-align: center;
    color: #888;
    padding: 40px 20px;
    font-size: 14px;
  }

  /* Scrollbar */
  .modal-content::-webkit-scrollbar {
    width: 8px;
  }

  .modal-content::-webkit-scrollbar-track {
    background: #f1f1f1;
  }

  .modal-content::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 4px;
  }

  .modal-content::-webkit-scrollbar-thumb:hover {
    background: #555;
  }

  @media (max-width: 768px) {
    .modal-container {
      max-height: 100vh;
      border-radius: 0;
    }

    .forum-posts-container {
      grid-template-columns: 1fr;
    }
  }
</style>
<body>

<!-- ==================== HEADER ==================== -->
<nav class="head_bar" id="head_bar">
  <a href="/home">
    <i class="fa fa-home" style="font-size: 25px; color: #fff; margin-right: 10px;"></i>
  </a>
  <a class="Web_subTitle">ToeiX - H·ªçc ti·∫øng Anh ngay!</a>

  <!-- Search Box -->
  <div class="serch_box">
    <input class="_input_15ttk_39" id="__serch_box" placeholder="T√¨m ki·∫øm kh√≥a h·ªçc, b√†i vi·∫øt..." spellcheck="false">
    <div id="search_results"></div>
  </div>

  <!-- My Courses -->
  <div class="user_courses">
    <div class="user_courses_title" id="user_courses_title">
      <p>Kh√≥a h·ªçc c·ªßa t√¥i</p>
      <div id="user-course-container" style="display: none; position: absolute; top: 60px; background: #fff; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000; width: 200px;">
        <!-- JS s·∫Ω th√™m kh√≥a h·ªçc -->
      </div>
    </div>
    <i class="fa fa-caret-down"></i>
  </div>

  <!-- Notification -->
  <div class="noti_box" onclick="toggleNotifications()">
    <i class="fa-solid fa-bell"></i>
  </div>
  <div id="notification-list" class="notification-list" style="display: none;">
    <p class="title">Th√¥ng b√°o</p>
    <div id="notification-container"></div>
  </div>

  <!-- User Avatar -->
  <div class="user_i4_box">
    <div class="user_ico" onclick="toggleMenu()">
      <img th:src="@{/avatar/user_avatar.jpg}" alt="avatar">
    </div>
    <div class="user_status"></div>
  </div>

  <!-- Profile Menu -->
  <div class="profile-menu" id="profileMenu" style="display: none;">
    <div class="profile-header">
      <img th:src="@{/avatar/user_avatar.jpg}" class="profile-pic" alt="avatar">
      <div class="profile-info">
        <p class="name" id="fullName">Nguy·ªÖn VƒÉn A</p>
        <p class="username" id="username">@nguyenvana</p>
      </div>
    </div>
    <hr>
    <ul>
      <a href="/personal" style="text-decoration: none"><li>Trang c√° nh√¢n</li></a>
      <li>Vi·∫øt blog</li>
      <a href="/vocabulary" style="text-decoration: none"><li>T·ª´ m·ªõi m·ªói ng√†y</li></a>
      <a href="/toeic-test" style="text-decoration: none"><li>Thi Th·ª≠ TOEIC</li></a>
      <hr>
      <li>C√†i ƒë·∫∑t</li>
      <li class="logout" onclick="logOut()">ƒêƒÉng xu·∫•t</li>
    </ul>
  </div>
</nav>

<!-- ==================== FORUM CONTENT ==================== -->
<div class="forum-container">
  <!-- Sidebar -->
  <div class="container">
    <div class="forum-header">
      <h3>Di·ªÖn ƒë√†n h·ªçc t·∫≠p üî•</h3>
    </div>

    <div class="forum-posts-container" id="forumPostsContainer">
      <!-- B√†i vi·∫øt s·∫Ω ƒë∆∞·ª£c load ·ªü ƒë√¢y -->
    </div>
  </div>

  <!-- Modal Chi ti·∫øt b√†i vi·∫øt -->
  <div class="modal-overlay" id="postModal">
    <div class="modal-container">
      <div class="modal-header">
        <h3>Chi ti·∫øt b√†i vi·∫øt</h3>
        <button class="modal-close" onclick="closeModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-content" id="modalContent">
        <!-- N·ªôi dung chi ti·∫øt b√†i vi·∫øt s·∫Ω ƒë∆∞·ª£c load ·ªü ƒë√¢y -->
      </div>
    </div>
  </div>

  <script>
    // D·ªØ li·ªáu m·∫´u
    const samplePosts = [
      {
        id: 1,
        username: "Nguy·ªÖn VƒÉn A",
        createdAt: new Date(Date.now() - 3600000).toISOString(),
        title: "Chia s·∫ª kinh nghi·ªám h·ªçc TOEIC 900+",
        content: "Xin ch√†o m·ªçi ng∆∞·ªùi! M√¨nh v·ª´a thi ƒë∆∞·ª£c 920 ƒëi·ªÉm TOEIC sau 3 th√°ng h·ªçc t·∫≠p chƒÉm ch·ªâ. M√¨nh mu·ªën chia s·∫ª m·ªôt s·ªë tips v√† kinh nghi·ªám cho c√°c b·∫°n ƒëang chu·∫©n b·ªã thi.\n\n1. Luy·ªán nghe m·ªói ng√†y √≠t nh·∫•t 1 ti·∫øng\n2. H·ªçc t·ª´ v·ª±ng theo ch·ªß ƒë·ªÅ\n3. L√†m ƒë·ªÅ th·ª≠ nghi·ªám th∆∞·ªùng xuy√™n\n4. Ph√¢n t√≠ch l·ªói sai ƒë·ªÉ c·∫£i thi·ªán\n\nHy v·ªçng chia s·∫ª c·ªßa m√¨nh s·∫Ω gi√∫p √≠ch cho c√°c b·∫°n!",
        tags: ["TOEIC", "Kinh nghi·ªám", "Tips"],
        views: 245,
        comments: 18,
        likes: 67,
        liked: false
      },
      {
        id: 2,
        username: "Tr·∫ßn Th·ªã B",
        createdAt: new Date(Date.now() - 7200000).toISOString(),
        title: "T√†i li·ªáu luy·ªán Speaking hi·ªáu qu·∫£",
        content: "M√¨nh ƒë√£ t·ªïng h·ª£p m·ªôt s·ªë t√†i li·ªáu v√† ph∆∞∆°ng ph√°p luy·ªán Speaking r·∫•t hi·ªáu qu·∫£. C√°c b·∫°n c√≥ th·ªÉ tham kh·∫£o:\n\n- Shadowing v·ªõi podcast ti·∫øng Anh\n- Ghi √¢m v√† t·ª± ƒë√°nh gi√°\n- Tham gia c√¢u l·∫°c b·ªô ti·∫øng Anh\n- Luy·ªán t·∫≠p v·ªõi ·ª©ng d·ª•ng AI\n\nC√°c b·∫°n c√≥ th·ªÉ chia s·∫ª th√™m ph∆∞∆°ng ph√°p c·ªßa m√¨nh nh√©!",
        tags: ["Speaking", "T√†i li·ªáu", "Ph∆∞∆°ng ph√°p"],
        views: 189,
        comments: 12,
        likes: 45,
        liked: false
      },
      {
        id: 3,
        username: "L√™ VƒÉn C",
        createdAt: new Date(Date.now() - 86400000).toISOString(),
        title: "C√°ch h·ªçc t·ª´ v·ª±ng kh√¥ng bao gi·ªù qu√™n",
        content: "Sau nhi·ªÅu nƒÉm h·ªçc ti·∫øng Anh, m√¨nh ƒë√£ t√¨m ra ƒë∆∞·ª£c ph∆∞∆°ng ph√°p h·ªçc t·ª´ v·ª±ng hi·ªáu qu·∫£ nh·∫•t:\n\n1. H·ªçc t·ª´ trong ng·ªØ c·∫£nh\n2. S·ª≠ d·ª•ng flashcard v·ªõi h·ªá th·ªëng l·∫∑p l·∫°i ng·∫Øt qu√£ng\n3. Vi·∫øt c√¢u v√≠ d·ª• c·ªßa ri√™ng m√¨nh\n4. √Åp d·ª•ng t·ª´ m·ªõi trong giao ti·∫øp h√†ng ng√†y\n5. √în t·∫≠p ƒë·ªÅu ƒë·∫∑n\n\nPh∆∞∆°ng ph√°p n√†y ƒë√£ gi√∫p m√¨nh nh·ªõ t·ª´ l√¢u h∆°n r·∫•t nhi·ªÅu!",
        tags: ["T·ª´ v·ª±ng", "Ph∆∞∆°ng ph√°p", "H·ªçc t·∫≠p"],
        views: 567,
        comments: 34,
        likes: 123,
        liked: false
      },
      {
        id: 4,
        username: "Ph·∫°m Th·ªã D",
        createdAt: new Date(Date.now() - 172800000).toISOString(),
        title: "L·ªô tr√¨nh h·ªçc IELTS t·ª´ 0 l√™n 7.5",
        content: "M√¨nh ƒë√£ ho√†n th√†nh l·ªô tr√¨nh h·ªçc IELTS t·ª´ 0 l√™n 7.5 sau 6 th√°ng. ƒê√¢y l√† l·ªô tr√¨nh chi ti·∫øt:\n\nTh√°ng 1-2: H·ªçc n·ªÅn t·∫£ng grammar v√† t·ª´ v·ª±ng c∆° b·∫£n\nTh√°ng 3-4: Luy·ªán 4 k·ªπ nƒÉng c∆° b·∫£n\nTh√°ng 5-6: Luy·ªán ƒë·ªÅ v√† ho√†n thi·ªán k·ªπ nƒÉng\n\nM√¨nh s·∫Ω chia s·∫ª chi ti·∫øt h∆°n trong c√°c b√†i vi·∫øt ti·∫øp theo!",
        tags: ["IELTS", "L·ªô tr√¨nh", "H·ªçc t·∫≠p"],
        views: 432,
        comments: 28,
        likes: 89,
        liked: false
      }
    ];

    // D·ªØ li·ªáu b√¨nh lu·∫≠n m·∫´u
    const sampleComments = {
      1: [
        { id: 1, username: "Ho√†ng VƒÉn E", text: "C·∫£m ∆°n b·∫°n ƒë√£ chia s·∫ª! R·∫•t h·ªØu √≠ch cho m√¨nh.", time: "2 gi·ªù tr∆∞·ªõc" },
        { id: 2, username: "V≈© Th·ªã F", text: "M√¨nh c≈©ng ƒëang chu·∫©n b·ªã thi TOEIC, b·∫°n c√≥ th·ªÉ chia s·∫ª th√™m v·ªÅ ph·∫ßn Reading ƒë∆∞·ª£c kh√¥ng?", time: "1 gi·ªù tr∆∞·ªõc" },
        { id: 3, username: "ƒê·∫∑ng VƒÉn G", text: "920 ƒëi·ªÉm th·∫≠t tuy·ªát v·ªùi! Ch√∫c m·ª´ng b·∫°n nh√©!", time: "30 ph√∫t tr∆∞·ªõc" }
      ],
      2: [
        { id: 1, username: "B√πi Th·ªã H", text: "M√¨nh r·∫•t th√≠ch ph∆∞∆°ng ph√°p Shadowing, n√≥ gi√∫p m√¨nh c·∫£i thi·ªán ph√°t √¢m r·∫•t nhi·ªÅu!", time: "3 gi·ªù tr∆∞·ªõc" },
        { id: 2, username: "Ng√¥ VƒÉn I", text: "B·∫°n c√≥ th·ªÉ g·ª£i √Ω m·ªôt s·ªë podcast hay kh√¥ng?", time: "2 gi·ªù tr∆∞·ªõc" }
      ],
      3: [
        { id: 1, username: "Phan Th·ªã J", text: "Flashcard th·ª±c s·ª± hi·ªáu qu·∫£! M√¨nh ƒëang d√πng Anki.", time: "1 ng√†y tr∆∞·ªõc" },
        { id: 2, username: "Tr∆∞∆°ng VƒÉn K", text: "C·∫£m ∆°n b·∫°n ƒë√£ chia s·∫ª ph∆∞∆°ng ph√°p hay!", time: "20 gi·ªù tr∆∞·ªõc" }
      ],
      4: [
        { id: 1, username: "L√Ω Th·ªã L", text: "L·ªô tr√¨nh r·∫•t chi ti·∫øt! M√¨nh s·∫Ω theo d√µi.", time: "2 ng√†y tr∆∞·ªõc" },
        { id: 2, username: "V√µ VƒÉn M", text: "6 th√°ng l√™n 7.5 th·∫≠t ·∫•n t∆∞·ª£ng!", time: "1 ng√†y tr∆∞·ªõc" }
      ]
    };

    // Format th·ªùi gian
    function formatTime(dateString) {
      const now = new Date();
      const postDate = new Date(dateString);
      const diffMs = now - postDate;
      const diffMins = Math.floor(diffMs / 60000);
      const diffHours = Math.floor(diffMs / 3600000);
      const diffDays = Math.floor(diffMs / 86400000);

      if (diffMins < 1) return 'V·ª´a xong';
      if (diffMins < 60) return `${diffMins} ph√∫t tr∆∞·ªõc`;
      if (diffHours < 24) return `${diffHours} gi·ªù tr∆∞·ªõc`;
      if (diffDays < 7) return `${diffDays} ng√†y tr∆∞·ªõc`;

      return postDate.toLocaleDateString('vi-VN');
    }

    // Load b√†i vi·∫øt
    function loadPosts() {
      const container = document.getElementById("forumPostsContainer");
      container.innerHTML = "";

      samplePosts.forEach(post => {
        const postCard = document.createElement("div");
        postCard.className = "forum-post-card";
        postCard.onclick = () => openModal(post.id);

        const initial = post.username.charAt(0).toUpperCase();

        postCard.innerHTML = `
                    <div class="post-header">
                        <div class="post-avatar">${initial}</div>
                        <div class="post-user-info">
                            <div class="post-username">${post.username}</div>
                            <div class="post-time">${formatTime(post.createdAt)}</div>
                        </div>
                    </div>
                    <div class="post-title">${post.title}</div>
                    <div class="post-content">${post.content}</div>
                    <div class="post-tags">
                        ${post.tags.map(tag => `<span class="post-tag">${tag}</span>`).join('')}
                    </div>
                    <div class="post-stats">
                        <div class="post-stat">
                            <i class="fa-solid fa-eye"></i>
                            <span>${post.views}</span>
                        </div>
                        <div class="post-stat">
                            <i class="fa-solid fa-comment"></i>
                            <span>${post.comments}</span>
                        </div>
                        <div class="post-stat">
                            <i class="fa-solid fa-heart"></i>
                            <span>${post.likes}</span>
                        </div>
                    </div>
                `;

        container.appendChild(postCard);
      });
    }

    // M·ªü modal
    function openModal(postId) {
      const post = samplePosts.find(p => p.id === postId);
      if (!post) return;

      const modal = document.getElementById('postModal');
      const modalContent = document.getElementById('modalContent');
      const initial = post.username.charAt(0).toUpperCase();
      const comments = sampleComments[postId] || [];

      modalContent.innerHTML = `
                <div class="modal-post-header">
                    <div class="modal-post-avatar">${initial}</div>
                    <div class="post-user-info">
                        <div class="post-username">${post.username}</div>
                        <div class="post-time">${formatTime(post.createdAt)}</div>
                    </div>
                </div>
                <div class="modal-post-title">${post.title}</div>
                <div class="modal-post-content">${post.content.replace(/\n/g, '<br>')}</div>
                <div class="post-tags">
                    ${post.tags.map(tag => `<span class="post-tag">${tag}</span>`).join('')}
                </div>
                <div class="modal-post-actions">
                    <button class="action-btn ${post.liked ? 'active' : ''}" onclick="toggleLike(${post.id})">
                        <i class="fa-solid fa-heart"></i>
                        <span>${post.likes} Th√≠ch</span>
                    </button>
                    <button class="action-btn">
                        <i class="fa-solid fa-comment"></i>
                        <span>${post.comments} B√¨nh lu·∫≠n</span>
                    </button>
                    <button class="action-btn">
                        <i class="fa-solid fa-share"></i>
                        <span>Chia s·∫ª</span>
                    </button>
                </div>

                <div class="comments-section">
                    <div class="comments-header">B√¨nh lu·∫≠n (${comments.length})</div>

                    <div class="comment-input-container">
                        <div class="comment-input-avatar">U</div>
                        <div class="comment-input-wrapper">
                            <textarea
                                class="comment-input"
                                id="commentInput"
                                placeholder="Vi·∫øt b√¨nh lu·∫≠n..."
                                rows="1"
                                oninput="autoResize(this)"
                            ></textarea>
                            <div class="comment-actions" style="display: none;" id="commentActions">
                                <button class="comment-btn comment-btn-cancel" onclick="cancelComment()">H·ªßy</button>
                                <button class="comment-btn comment-btn-submit" onclick="submitComment(${post.id})" disabled id="submitBtn">ƒêƒÉng</button>
                            </div>
                        </div>
                    </div>

                    <div class="comments-list">
                        ${comments.length > 0 ? comments.map(comment => {
        const commentInitial = comment.username.charAt(0).toUpperCase();
        return `
                                <div class="comment-item">
                                    <div class="comment-avatar">${commentInitial}</div>
                                    <div class="comment-content-wrapper">
                                        <div class="comment-bubble">
                                            <div class="comment-username">${comment.username}</div>
                                            <div class="comment-text">${comment.text}</div>
                                        </div>
                                        <div class="comment-meta">
                                            <span>${comment.time}</span>
                                            <span class="comment-action">Th√≠ch</span>
                                            <span class="comment-action">Tr·∫£ l·ªùi</span>
                                        </div>
                                    </div>
                                </div>
                            `;
      }).join('') : '<div class="no-comments">Ch∆∞a c√≥ b√¨nh lu·∫≠n n√†o. H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n b√¨nh lu·∫≠n!</div>'}
                    </div>
                </div>
            `;

      modal.classList.add('active');
      document.body.style.overflow = 'hidden';

      // Setup comment input listeners
      setupCommentInput();
    }

    // ƒê√≥ng modal
    function closeModal() {
      const modal = document.getElementById('postModal');
      modal.classList.remove('active');
      document.body.style.overflow = 'auto';
    }

    // Click outside modal ƒë·ªÉ ƒë√≥ng
    document.getElementById('postModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeModal();
      }
    });

    // Toggle like
    function toggleLike(postId) {
      const post = samplePosts.find(p => p.id === postId);
      if (post) {
        post.liked = !post.liked;
        post.likes += post.liked ? 1 : -1;
        openModal(postId); // Refresh modal
        loadPosts(); // Refresh list
      }
    }

    // Auto resize textarea
    function autoResize(textarea) {
      textarea.style.height = 'auto';
      textarea.style.height = textarea.scrollHeight + 'px';
    }

    // Setup comment input
    function setupCommentInput() {
      const input = document.getElementById('commentInput');
      const actions = document.getElementById('commentActions');
      const submitBtn = document.getElementById('submitBtn');

      if (!input) return;

      input.addEventListener('focus', () => {
        actions.style.display = 'flex';
      });

      input.addEventListener('input', () => {
        submitBtn.disabled = input.value.trim().length === 0;
      });
    }

    // Cancel comment
    function cancelComment() {
      const input = document.getElementById('commentInput');
      const actions = document.getElementById('commentActions');
      input.value = '';
      input.style.height = 'auto';
      actions.style.display = 'none';
    }

    // Submit comment
    function submitComment(postId) {
      const input = document.getElementById('commentInput');
      const text = input.value.trim();

      if (text.length === 0) return;

      // Add comment to data
      if (!sampleComments[postId]) {
        sampleComments[postId] = [];
      }

      const newComment = {
        id: Date.now(),
        username: "User (B·∫°n)",
        text: text,
        time: "V·ª´a xong"
      };

      sampleComments[postId].unshift(newComment);

      // Update post comment count
      const post = samplePosts.find(p => p.id === postId);
      if (post) {
        post.comments++;
      }

      // Refresh modal and list
      openModal(postId);
      loadPosts();
    }

    // ESC key to close modal
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeModal();
      }
    });

    // Load posts on page load
    document.addEventListener("DOMContentLoaded", function() {
      loadPosts();
    });
  </script>
      <!-- Th√™m 2 b√†i n·ªØa n·∫øu c·∫ßn... -->
    </div>
    <!-- Pagination -->
    <div class="pagination">
      <button class="page-btn" id="prevPage" disabled>Tr∆∞·ªõc</button>
      <div class="page-numbers">
        <button class="page-number active">1</button>
        <button class="page-number">2</button>
      </div>
      <button class="page-btn" id="nextPage">Ti·∫øp</button>
    </div>
  </main>
</div>

<!-- ==================== MODAL T·∫†O B√ÄI ==================== -->
<div class="modal" id="createPostModal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h2>T·∫°o b√†i vi·∫øt m·ªõi</h2>
      <span class="close-modal" onclick="closeCreatePostModal()">√ó</span>
    </div>
    <div class="modal-body">
      <form id="createPostForm">
        <div class="form-group">
          <label>Ti√™u ƒë·ªÅ</label>
          <input type="text" id="postTitle" placeholder="Nh·∫≠p ti√™u ƒë·ªÅ..." required>
        </div>
        <div class="form-group">
          <label>Danh m·ª•c</label>
          <select id="postCategory" required>
            <option value="">Ch·ªçn danh m·ª•c</option>
            <option value="toeic">TOEIC</option>
            <option value="ielts">IELTS</option>
            <option value="grammar">Grammar</option>
            <option value="vocabulary">T·ª´ v·ª±ng</option>
          </select>
        </div>
        <div class="form-group">
          <label>N·ªôi dung</label>
          <textarea id="postContent" rows="6" placeholder="Nh·∫≠p n·ªôi dung..." required></textarea>
        </div>
        <div class="form-group">
          <label>Th·∫ª</label>
          <input type="text" id="postTags" placeholder="TOEIC, Tips, ...">
        </div>
        <div class="form-actions">
          <button type="button" class="btn-cancel" onclick="closeCreatePostModal()">H·ªßy</button>
          <button type="submit" class="btn-submit">ƒêƒÉng b√†i</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- ==================== T·ª™ ƒêI·ªÇN LABAN ==================== -->
<button id="dict-toggle-btn">
  <i class="fa fa-book"></i>
</button>
<div id="dict-container">
  <script>
    !function(){
      var h={s:"https://dict.laban.vn",w:260,h:260,hl:2,th:3};
      function loadScript(t,e){
        var n=document.createElement("script");
        n.type="text/javascript";
        n.onload=e;
        n.src=t;
        document.head.appendChild(n);
      }
      setTimeout(function(){
        loadScript("https://stc-laban.zdn.vn/dictionary/js/plugin/lbdictplugin.frame.min.js",function(){
          lbDictPluginFrame.init(h);
        })
      },1000);
    }();
  </script>
</div>

<!-- ==================== FOOTER ==================== -->
<!--Footer =================================================================================================================================-->
<footer class="footer_wrapper">
  <div class="footer-column">
    <h3>H·ªçc Ti·∫øng Anh ƒê·ªÉ ƒêi L√†m</h3>
    <p>ƒêi·ªán tho·∫°i: 0398756015</p>
    <p>Email: Dinhdat1012vn@gmail.com</p>
    <p>ƒê·ªãa ch·ªâ: S·ªë 16, ng√µ 257, Thanh Nh√†n, Hai B√† Tr∆∞ng, H√† N·ªôi</p>
  </div>
  <div class="footer-column">
    <h3>V·ªÅ Ch√∫ng T√¥i</h3>
    <a href="#">Gi·ªõi thi·ªáu</a>
    <a href="#">Li√™n h·ªá</a>
    <a href="#">ƒêi·ªÅu kho·∫£n</a>
    <a href="#">B·∫£o m·∫≠t</a>
  </div>
  <div class="footer-column">
    <h3>S·∫£n ph·∫©m</h3>
    <a href="#">S·∫£n Ph·∫©m 1</a>
    <a href="#">S·∫£n Ph·∫©m 2</a>
    <a href="#">S·∫£n ph·∫©m 3</a>
  </div>
  <div class="footer-column">
    <h3>C√¥ng c·ª•</h3>
    <a href="#">s·∫£n ph·∫©m 3</a>
    <a href="#">S·∫£n ph·∫©m 2</a>
  </div>
  <div class="footer-column">
    <h3>Theo d√µi ch√∫ng t√¥i.</h3>
    <div class="footer-social">
      <img th:src="@{/icon/ytb_icon.png}" alt="YouTube">
      <img th:src="@{/icon/fb_icon.png}" alt="Facebook">
      <img th:src="@{/icon/instagram.png}" alt="Instagram">
    </div>
  </div>
</footer>
<!-- ==================== JS: T√î M√ÄU XANH KHI NH·∫§N ==================== -->
<script>
  // T√¥ m√†u xanh khi nh·∫•n v√†o Danh m·ª•c
  document.querySelectorAll('.category-item').forEach(item => {
    item.addEventListener('click', function() {
      document.querySelectorAll('.category-item').forEach(i => i.classList.remove('active'));
      this.classList.add('active');
    });
  });

  // T√¥ m√†u xanh khi nh·∫•n v√†o B·ªô l·ªçc
  document.querySelectorAll('.filter-tab').forEach(tab => {
    tab.addEventListener('click', function() {
      document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
      this.classList.add('active');
    });
  });

  // Modal
  function showCreatePostModal() {
    document.getElementById('createPostModal').style.display = 'flex';
  }
  function closeCreatePostModal() {
    document.getElementById('createPostModal').style.display = 'none';
  }

  // ƒê√≥ng modal khi nh·∫•n ngo√†i
  window.addEventListener('click', function(e) {
    const modal = document.getElementById('createPostModal');
    if (e.target === modal) closeCreatePostModal();
  });

  // T·ª´ ƒëi·ªÉn
  document.getElementById('dict-toggle-btn').addEventListener('click', function(e) {
    const container = document.getElementById('dict-container');
    container.style.display = container.style.display === 'block' ? 'none' : 'block';
    e.stopPropagation();
  });
  document.getElementById('dict-container').addEventListener('click', e => e.stopPropagation());
  document.addEventListener('click', () => {
    document.getElementById('dict-container').style.display = 'none';
  });
</script>

<!-- CSS b·ªï sung cho n√∫t active -->
<style>
  .category-item.active, .filter-tab.active {
    background-color: #0073e6 !important;
    color: white !important;
    border-radius: 8px;
  }
  .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 9999; }
  .modal-content { background: white; width: 90%; max-width: 600px; border-radius: 12px; overflow: hidden; }
  .form-group { margin-bottom: 15px; }
  .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
  .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; }
  .form-actions { text-align: right; margin-top: 20px; }
  .btn-cancel, .btn-submit { padding: 10px 20px; margin-left: 10px; border: none; border-radius: 6px; cursor: pointer; }
  .btn-cancel { background: #ddd; }
  .btn-submit { background: #0073e6; color: white; }
</style>
</body>
</html>